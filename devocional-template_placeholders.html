<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Devocional - Reflexi√≥n para cada d√≠a</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&family=Poppins:wght@600;700;800&family=Playfair+Display:ital,wght@0,500;1,500&display=swap" rel="stylesheet">
  
  <style>
    /* ============================================
       VARIABLES DE COLOR - Personaliza aqu√≠
       ============================================ */
    :root {
      /* Colores principales */
      --color-primario: #39A8DA;
      --color-primario-oscuro: #2d8ab3;
      --color-primario-rgb: 57, 168, 218;
      --color-secundario: #5A5F7A;
      --color-acento: #003366;
      --color-acento-rgb: 0, 51, 102;
      
      /* Colores de texto */
      --color-texto: #333333;
      --color-texto-claro: #666666;
      
      /* Colores de fondo */
      --color-fondo: #f8f9fa;
      --color-blanco: #FFFFFF;
      
      /* Sombras */
      --color-sombra: rgba(0, 0, 0, 0.1);
      --color-sombra-fuerte: rgba(0, 0, 0, 0.2);
      --color-sombra-texto: rgba(0, 0, 0, 0.4);
      --color-sombra-primario: rgba(var(--color-primario-rgb), 0.3);
      --color-sombra-primario-suave: rgba(var(--color-primario-rgb), 0.25);
      
      /* Colores de overlay */
      --color-overlay-inicio: rgba(var(--color-acento-rgb), 0.3);
      --color-overlay-fin: rgba(var(--color-acento-rgb), 0.5);
      
      /* Colores decorativos */
      --color-comillas: var(--color-primario);
      --color-separador: var(--color-fondo);
      --color-flecha-accion: var(--color-primario);
      --color-numero-lista: var(--color-blanco);
      --color-fondo-numero-lista: var(--color-primario);
      
      /* Espaciado */
      --espaciado-xs: 0.5rem;
      --espaciado-sm: 1rem;
      --espaciado-md: 1.5rem;
      --espaciado-lg: 2rem;
      --espaciado-xl: 3rem;
      
      /* Border radius */
      --radio-sm: 4px;
      --radio-md: 8px;
      --radio-lg: 12px;
    }

    /* ============================================
       RESET Y BASE
       ============================================ */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      font-size: 16px;
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Lato', -apple-system, BlinkMacSystemFont, sans-serif;
      background-color: var(--color-fondo);
      color: var(--color-texto);
      line-height: 1.6;
      min-height: 100vh;
    }

    /* ============================================
       CONTENEDOR PRINCIPAL
       ============================================ */
    .devocional {
      max-width: 650px;
      margin: 0 auto;
      background-color: var(--color-blanco);
      box-shadow: 0 4px 20px var(--color-sombra);
    }

    /* ============================================
       HEADER
       ============================================ */
    .devocional__header {
      position: relative;
      overflow: hidden;
    }

    .devocional__header-imagen {
      width: 100%;
      height: 220px;
      object-fit: cover;
      object-position: center;
      display: block;
      filter: brightness(0.7);
    }

    .devocional__header-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: var(--espaciado-md);
      background: linear-gradient(
        to bottom,
        var(--color-overlay-inicio) 0%,
        var(--color-overlay-fin) 100%
      );
    }

    .devocional__titulo {
      font-family: 'Poppins', sans-serif;
      font-size: clamp(1.75rem, 5vw, 2.5rem);
      font-weight: 700;
      color: var(--color-blanco);
      letter-spacing: 0.3em;
      text-shadow: 2px 2px 8px var(--color-sombra-texto);
      margin-bottom: var(--espaciado-xs);
    }

    .devocional__subtitulo {
      font-size: clamp(0.65rem, 2vw, 0.8rem);
      color: var(--color-blanco);
      letter-spacing: 0.15em;
      text-shadow: 1px 1px 4px var(--color-sombra-texto);
      opacity: 0.95;
    }

    /* ============================================
       CITA B√çBLICA (Badge)
       ============================================ */
    .devocional__cita-badge {
      background: var(--color-primario);
      color: var(--color-blanco);
      font-weight: 700;
      font-size: clamp(0.8rem, 2.5vw, 0.95rem);
      text-align: center;
      padding: var(--espaciado-sm) var(--espaciado-md);
      margin: 0 var(--espaciado-xl);
      border-radius: var(--radio-md);
      position: relative;
      top: -1.5rem;
      box-shadow: 0 4px 15px var(--color-sombra-primario);
      z-index: 10;
    }

    /* Tri√°ngulos decorativos */
    .devocional__cita-badge::before,
    .devocional__cita-badge::after {
      content: "";
      position: absolute;
      bottom: -10px;
      width: 0;
      height: 0;
      border-top: 10px solid var(--color-secundario);
    }

    .devocional__cita-badge::before {
      left: 0;
      border-left: 30px solid transparent;
    }

    .devocional__cita-badge::after {
      right: 0;
      border-right: 30px solid transparent;
    }

    /* ============================================
       FECHA
       ============================================ */
    .devocional__fecha {
      text-align: center;
      padding: var(--espaciado-xs) var(--espaciado-md);
      margin-bottom: var(--espaciado-sm);
    }

    .devocional__fecha-texto {
      font-size: 0.75rem;
      letter-spacing: 0.15em;
      color: var(--color-texto-claro);
      font-weight: 400;
      text-transform: uppercase;
    }

    /* ============================================
       BOT√ìN DESCARGAR PNG
       ============================================ */
    .devocional__download-btn {
      display: block;
      margin: var(--espaciado-sm) auto;
      padding: var(--espaciado-xs) var(--espaciado-md);
      background: linear-gradient(135deg, var(--color-primario) 0%, var(--color-primario-oscuro) 100%);
      color: var(--color-blanco);
      border: none;
      border-radius: var(--radio-md);
      font-family: 'Poppins', sans-serif;
      font-size: 0.875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      cursor: pointer;
      box-shadow: 0 2px 8px var(--color-sombra-primario);
      transition: all 0.3s ease;
    }

    .devocional__download-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px var(--color-sombra-primario-suave);
    }

    .devocional__download-btn:active {
      transform: translateY(0);
    }

    /* Clase para ocultar elementos en capturas de pantalla y al imprimir */
    @media print {
      .no-screenshot {
        display: none !important;
      }
    }

    /* ============================================
       REPRODUCTOR DE AUDIO
       ============================================ */
    .devocional__audio-player {
      margin: var(--espaciado-md) var(--espaciado-xl);
      background: white;
      border: 2px solid var(--color-primario);
      border-radius: var(--radio-lg);
      padding: var(--espaciado-md);
      box-shadow: 0 2px 8px var(--color-sombra);
    }

    .devocional__audio-loading {
      text-align: center;
      color: var(--color-texto-claro);
      font-size: 0.875rem;
      padding: var(--espaciado-sm);
    }

    .devocional__audio-loading::before {
      content: "‚è≥";
      display: inline-block;
      margin-right: 0.5rem;
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    .devocional__audio-error {
      text-align: center;
      color: var(--color-texto-claro);
      font-size: 0.875rem;
      padding: var(--espaciado-sm);
    }

    .devocional__audio-controls {
      display: none;
    }

    .devocional__audio-controls.loaded {
      display: block;
    }

    .devocional__audio-controls audio {
      width: 100%;
      outline: none;
    }

    /* Personalizaci√≥n del audio player (navegadores webkit) */
    .devocional__audio-controls audio::-webkit-media-controls-panel {
      background-color: var(--color-blanco);
    }

    .devocional__audio-controls audio::-webkit-media-controls-play-button,
    .devocional__audio-controls audio::-webkit-media-controls-pause-button {
      background-color: var(--color-primario);
      border-radius: 50%;
    }

    /* ============================================
       VERS√çCULO PRINCIPAL
       ============================================ */
    .devocional__versiculo-section {
      background: linear-gradient(135deg, var(--color-primario) 0%, var(--color-primario-oscuro) 100%);
      margin: 0 var(--espaciado-xl);
      border-radius: var(--radio-lg);
      padding: var(--espaciado-lg);
      box-shadow: 0 4px 20px var(--color-sombra-primario-suave);
    }

    .devocional__versiculo {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: clamp(1.1rem, 3.5vw, 1.4rem);
      font-weight: 500;
      font-style: italic;
      color: var(--color-acento);
      background: var(--color-blanco);
      padding: var(--espaciado-md) var(--espaciado-lg);
      border-radius: var(--radio-md);
      text-align: center;
      line-height: 1.7;
      margin-bottom: var(--espaciado-sm);
      position: relative;
    }

    .devocional__versiculo::before,
    .devocional__versiculo::after {
      font-family: Georgia, serif;
      font-size: 2.5rem;
      color: var(--color-comillas);
      opacity: 0.3;
      position: absolute;
    }

    .devocional__versiculo::before {
      content: "";
      top: 0.1rem;
      left: 0.5rem;
    }

    .devocional__versiculo::after {
      content: "";
      bottom: -0.5rem;
      right: 0.5rem;
    }

    .devocional__etiqueta {
      display: inline-block;
      background: var(--color-blanco);
      color: var(--color-primario);
      font-size: 0.7rem;
      font-weight: 700;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      padding: var(--espaciado-xs) var(--espaciado-sm);
      border-radius: var(--radio-sm);
    }

    /* ============================================
       CONTENIDO
       ============================================ */
    .devocional__contenido {
      padding: var(--espaciado-lg) var(--espaciado-xl) var(--espaciado-xl) var(--espaciado-xl);
    }

    .devocional__contenido-titulo {
      font-family: 'Poppins', sans-serif;
      font-size: clamp(1rem, 3vw, 1.25rem);
      font-weight: 700;
      color: var(--color-acento);
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: var(--espaciado-md);
      position: relative;
      padding-bottom: var(--espaciado-sm);
    }

    .devocional__contenido-titulo::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: var(--color-primario);
      border-radius: 2px;
    }

    .devocional__texto {
      font-size: 1rem;
      line-height: 1.8;
      color: var(--color-texto);
      margin-bottom: var(--espaciado-md);
      text-align: justify;
      hyphens: auto;
    }

    .devocional__lista {
      margin: var(--espaciado-md) 0;
      padding-left: var(--espaciado-md);
    }

    .devocional__lista li {
      margin-bottom: var(--espaciado-sm);
      line-height: 1.7;
      position: relative;
      padding-left: var(--espaciado-xs);
    }

    .devocional__lista--numerada {
      counter-reset: item;
      list-style: none;
      padding-left: 0;
    }

    .devocional__lista--numerada li {
      counter-increment: item;
      padding-left: var(--espaciado-lg);
    }

    .devocional__lista--numerada li::before {
      content: counter(item);
      position: absolute;
      left: 0;
      top: 0;
      width: 1.5rem;
      height: 1.5rem;
      background: var(--color-fondo-numero-lista);
      color: var(--color-numero-lista);
      border-radius: 50%;
      font-size: 0.8rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* ============================================
       SECCI√ìN ACCI√ìN
       ============================================ */
    .devocional__accion {
      background: linear-gradient(135deg, var(--color-primario) 0%, var(--color-primario-oscuro) 100%);
      margin: var(--espaciado-lg) var(--espaciado-xl) var(--espaciado-lg) var(--espaciado-xl);
      border-radius: var(--radio-lg);
      padding: var(--espaciado-lg);
    }

    .devocional__accion-titulo {
      color: var(--color-blanco);
      font-family: 'Poppins', sans-serif;
      font-size: 0.8rem;
      font-weight: 700;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      text-align: center;
      margin-bottom: var(--espaciado-sm);
    }

    .devocional__accion-contenido {
      background: var(--color-blanco);
      border-radius: var(--radio-md);
      padding: var(--espaciado-md);
    }

    .devocional__accion-contenido p {
      margin-bottom: var(--espaciado-sm);
      color: var(--color-texto);
    }

    .devocional__accion-contenido ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .devocional__accion-contenido li {
      padding: var(--espaciado-xs) 0;
      padding-left: var(--espaciado-md);
      position: relative;
      border-bottom: 1px solid var(--color-separador);
    }

    .devocional__accion-contenido li:last-child {
      border-bottom: none;
    }

    .devocional__accion-contenido li::before {
      content: "‚Üí";
      position: absolute;
      left: 0;
      color: var(--color-flecha-accion);
      font-weight: bold;
    }

    /* ============================================
       FOOTER
       ============================================ */
    .devocional__footer {
      background: var(--color-acento);
      color: var(--color-blanco);
      text-align: center;
      padding: var(--espaciado-md);
      font-size: 0.75rem;
      letter-spacing: 0.1em;
    }

    /* ============================================
       RESPONSIVE - TABLET
       ============================================ */
    @media (max-width: 768px) {
      .devocional {
        margin: 0;
        box-shadow: none;
      }

      .devocional__header-imagen {
        height: 200px;
      }

      .devocional__cita-badge {
        margin: 0 var(--espaciado-sm);
      }

      .devocional__versiculo-section {
        margin: 0 var(--espaciado-sm);
      }

      .devocional__contenido {
        padding: var(--espaciado-md) var(--espaciado-sm);
      }

      .devocional__accion {
        margin: 0 var(--espaciado-sm);
        margin-bottom: var(--espaciado-sm);
      }
    }

    /* ============================================
       RESPONSIVE - M√ìVIL
       ============================================ */
    @media (max-width: 480px) {
      html {
        font-size: 15px;
      }

      .devocional__header-imagen {
        height: 180px;
      }

      .devocional__titulo {
        letter-spacing: 0.2em;
      }

      .devocional__cita-badge {
        top: -1rem;
        padding: var(--espaciado-xs) var(--espaciado-sm);
      }

      .devocional__cita-badge::before,
      .devocional__cita-badge::after {
        bottom: -8px;
        border-top-width: 8px;
      }

      .devocional__cita-badge::before {
        border-left-width: 20px;
      }

      .devocional__cita-badge::after {
        border-right-width: 20px;
      }

      .devocional__versiculo {
        padding: var(--espaciado-sm);
      }

      .devocional__versiculo::before,
      .devocional__versiculo::after {
        font-size: 2rem;
      }

      .devocional__texto {
        text-align: left;
      }
    }

    /* ============================================
       UTILIDADES DE IMPRESI√ìN
       ============================================ */
    @media print {
      body {
        background: white;
      }

      .devocional {
        box-shadow: none;
        max-width: 100%;
      }

      .devocional__header-imagen {
        filter: none;
      }
    }
  </style>
</head>
<body>

<article class="devocional">
  <!-- HEADER -->
  <header class="devocional__header">
    <img
      src="images/l02.jpg"
      alt="Amanecer sobre monta√±as"
      class="devocional__header-imagen"
    >
    <div class="devocional__header-overlay">
      <h1 class="devocional__titulo">DEVOCIONAL</h1>
      <p class="devocional__subtitulo">REFLEXI√ìN PARA CADA D√çA</p>
    </div>
  </header>

  <!-- CITA B√çBLICA BADGE -->
  <div class="devocional__cita-badge">
    {{verse_ref}}
  </div>

  <!-- BOT√ìN DESCARGAR PNG -->
  <button class="devocional__download-btn no-screenshot" onclick="downloadAsPNG()">
    üì• Descargar como imagen
  </button>

  <!-- REPRODUCTOR DE AUDIO -->
  <div class="devocional__audio-player no-screenshot" id="audioPlayer">
    <div class="devocional__audio-loading" id="audioLoading">
      Cargando audio...
    </div>
    <div class="devocional__audio-error" id="audioError" style="display: none;">
      üîá Audio no disponible
    </div>
    <div class="devocional__audio-controls" id="audioControls">
      <audio controls preload="metadata" id="audioElement">
        <source id="audioSource" type="audio/mpeg">
        Tu navegador no soporta el elemento de audio.
      </audio>
    </div>
  </div>

  <!-- FECHA -->
  <div class="devocional__fecha">
    <span class="devocional__fecha-texto">{{date}}</span>
  </div>

  <!-- VERS√çCULO PRINCIPAL -->
  <section class="devocional__versiculo-section">
    <blockquote class="devocional__versiculo">
      {{verse_text}}
    </blockquote>
    <span class="devocional__etiqueta">Tesoro B√≠blico</span>
  </section>

  <!-- CONTENIDO PRINCIPAL -->
  <div class="devocional__contenido">
    <h2 class="devocional__contenido-titulo">{{devotional_title}}</h2>
    
    {{biblical_treasure}}
  </div>

  <!-- PUNTO DE ACCI√ìN -->
  <section class="devocional__accion">
    <h3 class="devocional__accion-titulo">Punto de Acci√≥n</h3>
    <div class="devocional__accion-contenido">
      {{call_to_action}}
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="devocional__footer">
    ¬© 2025 ¬∑ Devocionales Diarios ¬∑ Que tu d√≠a sea bendecido
  </footer>
</article>

<script>
  // ============================================
  // CONFIGURACI√ìN
  // ============================================
  const AUDIO_SERVER_URL = '{{audio_server_url}}';

  // ============================================
  // CARGA DE AUDIO
  // ============================================
  async function loadAudio() {
    const audioLoading = document.getElementById('audioLoading');
    const audioError = document.getElementById('audioError');
    const audioControls = document.getElementById('audioControls');
    const audioSource = document.getElementById('audioSource');
    const audioElement = document.getElementById('audioElement');

    try {
      // Obtener el nombre del archivo basado en la fecha
      const currentPage = window.location.pathname.split('/').pop();
      const audioFilename = currentPage.replace('.html', '.mp3');
      const audioUrl = `${AUDIO_SERVER_URL}${audioFilename}`;

      // Verificar si el audio existe
      const response = await fetch(audioUrl, { method: 'HEAD' });

      if (response.ok) {
        // El audio existe, configurar el reproductor
        audioSource.src = audioUrl;
        audioElement.load();

        // Mostrar controles cuando el audio est√© listo
        audioElement.addEventListener('loadedmetadata', () => {
          audioLoading.style.display = 'none';
          audioControls.classList.add('loaded');
        });

        // Manejar errores de carga
        audioElement.addEventListener('error', () => {
          audioLoading.style.display = 'none';
          audioError.style.display = 'block';
        });

      } else {
        // El audio no existe
        audioLoading.style.display = 'none';
        audioError.style.display = 'block';
      }

    } catch (error) {
      console.error('Error al cargar audio:', error);
      audioLoading.style.display = 'none';
      audioError.style.display = 'block';
    }
  }

  // Cargar el audio cuando la p√°gina est√© lista
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadAudio);
  } else {
    loadAudio();
  }

  // ============================================
  // DESCARGA DE IMAGEN
  // ============================================
  async function downloadAsPNG() {
    const button = document.querySelector('.devocional__download-btn');

    // Desactivar bot√≥n mientras se procesa
    button.disabled = true;
    button.textContent = '‚è≥ Descargando...';

    try {
      // Obtener el nombre del archivo PNG correspondiente
      // Si el HTML se llama "2025-12-10.html", buscar "2025-12-10.png"
      const currentPage = window.location.pathname.split('/').pop();
      const pngFilename = currentPage.replace('.html', '.png');

      // Intentar descargar el PNG que ya existe
      const response = await fetch(pngFilename);

      if (response.ok) {
        // El PNG existe, descargarlo directamente
        const blob = await response.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = pngFilename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        // Restaurar bot√≥n
        button.disabled = false;
        button.textContent = 'üì• Descargar como imagen';
      } else {
        // El PNG no existe, mostrar mensaje
        throw new Error('IMAGE_NOT_FOUND');
      }

    } catch (error) {
      console.error('Error al descargar imagen:', error);

      if (error.message === 'IMAGE_NOT_FOUND') {
        alert('‚ö†Ô∏è Imagen PNG no encontrada.\n\n' +
              'Para generar las im√°genes PNG, ejecuta:\n' +
              'DEVO_GENERATE_IMAGES=true node parse-devotional-json.js');
      } else {
        alert('Error al descargar la imagen. Verifica que el archivo PNG existe en la misma carpeta.');
      }

      // Restaurar bot√≥n
      button.disabled = false;
      button.textContent = 'üì• Descargar como imagen';
    }
  }
</script>

</body>
</html>
